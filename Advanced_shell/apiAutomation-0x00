#!/bin/bash

# File paths
OUTPUT_FILE="data.json"
ERROR_FILE="errors.txt"

# API endpoint for Pikachu
POKEMON_API="https://pokeapi.co/api/v2/pokemon/pikachu"

# Make request (using -k to avoid SSL certificate issues in Git Bash)
curl -s -k -o "$OUTPUT_FILE" -w "%{http_code}" "$POKEMON_API" > status_code.tmp 2>>"$ERROR_FILE"

# Check status code
STATUS_CODE=$(cat status_code.tmp)
rm status_code.tmp

if [ "$STATUS_CODE" -ne 200 ]; then
    echo "$(date '+%Y-%m-%d %H:%M:%S') - Request failed with status code: $STATUS_CODE" >> "$ERROR_FILE"
    rm -f "$OUTPUT_FILE"
    exit 1
fi
